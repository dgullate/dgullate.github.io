<!--
A project item includes the following metadata
title: text
start_date: 'YYYY-MM-DD'
end_date: 'YYYY-MM-DD'
description: text
-->

{{/* Hugo Blox: Projects */}}
{{/* Documentation: https://hugoblox.com/blocks/ */}}
{{/* License: https://github.com/HugoBlox/hugo-blox-builder/blob/main/LICENSE.md */}}

{{/* Initialise */}}
{{ $page := .wcPage }}
{{ $block := .wcBlock }}

{{/* Auto-collect items from child pages if not explicitly defined */}}
{{ $items := $block.content.items }}
{{ if not $items }}
  {{ $items = slice }}
  {{ range $page.Pages }}
    {{ $item := dict "title" .Title "description" .Params.description "url" .RelPermalink "imageResource" (.Resources.GetMatch "featured*") "start_date" .Params.start_date "end_date" .Params.end_date }}
    {{ $items = $items | append $item }}
  {{ end }}
{{ end }}

{{/* Sort items by start_date in descending order */}}
{{ if $items }}
  {{ $items = sort $items "start_date" "desc" }}
{{ end }}

{{ if $block.content.title }}
<div class="flex flex-col items-center max-w-prose mx-auto gap-3 justify-center">

  <div class="mb-6 text-3xl font-bold text-gray-900 dark:text-white">
    {{ $block.content.title | emojify | $page.RenderString }}
  </div>

  {{ with $block.content.text }}<div>{{ . | emojify | $page.RenderString }}</div>{{ end }}
</div>
{{ end }}

<div class="flex-auto">
  <div class="sm:px-8 mt-16 sm:mt-32">
    <div class="mx-auto w-full max-w-7xl lg:px-8">
      <div class="relative px-4 sm:px-8 lg:px-12">
        <div class="mx-auto max-w-4xl">
          <div class="mt-16 sm:mt-20">
            <ul class="flex flex-col gap-y-12" role="list">
              {{ range $idx, $key := $items }}
              <li class="group relative flex flex-row items-start gap-6 p-6 rounded-2xl transition hover:bg-neutral-50 dark:hover:bg-neutral-800/50">
                <div class="relative z-10 flex h-[120px] w-[120px] flex-shrink-0 items-center justify-center rounded-full bg-white shadow-md shadow-neutral-800/5 ring-1 ring-neutral-900/5 dark:border dark:border-neutral-700/50 dark:bg-neutral-800 dark:ring-0">
                  {{- $img := .imageResource -}}
                  {{ if not $img }}
                    {{- $img = resources.GetMatch (path.Join "media" .image) -}}
                  {{ end }}
                  {{ with $img }}
                    {{ $img = $img.Fit "120x120 webp" }}
                    <img alt="" class="h-[120px] w-[120px] rounded-full object-cover" data-nimg="1" decoding="async" height="{{$img.Height}}" width="{{$img.Width}}" loading="lazy" src="{{$img.RelPermalink}}" style="color: transparent;">
                  {{ end}}
                </div>
                <div class="flex-1 min-w-0">
                  <h2 class="text-lg font-semibold text-neutral-800 dark:text-neutral-100">
                    <a href="{{.url}}" target="_blank" rel="noopener" class="hover:text-primary-600 dark:hover:text-primary-400">
                      {{.title}}
                      {{ if and .start_date .end_date }}
                        {{ $startYear := (time .start_date).Year }}
                        {{ $endYear := (time .end_date).Year }}
                        <span class="text-base font-normal text-neutral-500 dark:text-neutral-400">({{ $startYear }} - {{ $endYear }})</span>
                      {{ else if .start_date }}
                        {{ $startYear := (time .start_date).Year }}
                        <span class="text-base font-normal text-neutral-500 dark:text-neutral-400">({{ $startYear }} - present)</span>
                      {{ end }}
                    </a>
                  </h2>
                  <p class="mt-2 text-sm text-neutral-600 dark:text-neutral-400">
                    {{.description | markdownify }}
                  </p>
                </div>
              </li>
              {{end}}
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>